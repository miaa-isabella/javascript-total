<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bootstrap demo</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <h1>Cell-Land</h1>

    <h2>Gestion de productos</h2>

    <h3>Lista de Productos</h3>
    <table class="table table-success table-striped" id="tablaProductos">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Precio</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="productos">
        <!-- Los datos de los productos se agregarán aquí -->
      </tbody>
    </table>

    <form>
      <div class="mb-3">
        <label for="exampleInputEmail1" class="form-label">nombre del producto</label>
        <input
          type="text"
          class="form-control"
          id="nombre"
          aria-describedby="emailHelp"
        />
        
      
        </div>
      </div>
      <div class="mb-3">
        <label for="exampleInputPassword1" class="form-label">Precio</label>
        <input
          type="number"
          class="form-control"
          id="precio"
        />
      </div>

      <button type="submit" class="btn btn-primary">agregar</button>
    </form>

    <script>

        const url = "window location.origin + '/productos'"
            function CargarProductos() {
              fetch(url)
              .then (response => response.json())
              .then (data => {
                const tbody = document.getElementById("productos")
                tbody.innerHTML = "";
                data.forEach(p  => {
                  tbody.innerHTML += `
                  <tr>
                    <td>${p.id}</td>
                   <td>
                   <input value="${p.nombre}" id="nombre-${p.id}">
                   </td>
                   <td>
                   <input value="${p.precio}" id="precio-${p.id}">
                   </td>
                   <td>
                   <button onclick="actualizarProducto(${p.id})">Actualizar</button>
                   <button onclick="eliminarProducto(${p.id})">Eliminar</button>
                   </td>

                  </tr>
                  `
                })
              })

            }

      function agregarProducto() {
        const nombre = document.getElementById("nombre").value;
        const precio = parseFloat(document.getElementById("precio").value);
        const producto = { nombre, precio };

        fetch(url, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(producto)
        })
        .then(response => response.json())
        .then(data => {
          document.getElementById("nombre").value = "";
          document.getElementById("precio").value = "";
          CargarProductos();
        });
      }



      function actualizarProducto(id) {
        const nombre = document.getElementById(`nombre-${id}`).value;
        const precio = parseFloat(document.getElementById(`precio-${id}`).value);

        fetch(`${url}/${id}`, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({nombre, precio})
        }).then(() => CargarProductos());
      }



            function eliminarProducto(id){

              fetch  (url + "/" + id, {
                method: "DELETE"
              }).then(CargarProductos)
            }

            CargarProductos()
    </script>
  </body>
</html>
